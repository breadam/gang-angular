!function(){"use strict";function config($urlRouterProvider,$locationProvider,$stateProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("welcome",{url:"/",templateUrl:"templates/welcome.html",controller:"WelcomeCtrl","abstract":!0,onEnter:function(token,$state){token.isValid()&&$state.go("home")}}).state("welcome.index",{url:"",templateUrl:"templates/welcome.index.html",controller:"WelcomeIndexCtrl",parent:"welcome"}).state("signin",{url:"signin",templateUrl:"templates/signin.html",controller:"SigninCtrl",parent:"welcome"}).state("signup",{url:"signup",templateUrl:"templates/signup.html",controller:"SignupCtrl",parent:"welcome"}).state("home",{url:"/home",templateUrl:"templates/home.html",controller:"HomeCtrl",resolve:{user:function(backend){return backend.request("me").then(function(res){return res.appUser})}}}).state("newteam",{url:"/newteam",templateUrl:"templates/newteam.html",controller:"NewTeamCtrl",parent:"home"}).state("chat",{url:"/:channel",templateUrl:"templates/chat.html",controller:"ChatCtrl",parent:"home"}),$locationProvider.html5Mode({enabled:!1,requireBase:!1}),$locationProvider.hashPrefix("!")}function run(){FastClick.attach(document.body)}angular.module("application",["ui.router","ngAnimate","facebook","luegg.directives","ngWebSocket","foundation"]).config(config).run(run)}();
!function(){"use strict";angular.module("application").service("backend",function(token,$http){this.request=function(action,query){var t=token.get(),headers={};return t&&(headers.Authorization=t),$http({method:"get",url:"http://app.ganghq.com/api/"+action,params:query,headers:headers}).then(function(response){return response.data})}})}();
!function(){"use strict";angular.module("application").service("chat",function($websocket){var activeChannel,ws=$websocket("ws://zeus.fikrimuhal.com:9000/ws"),messages=[];ws.onMessage(function(e){messages.push(JSON.parse(e.data))}),this.messages=messages,this.sendMessage=function(message){var channelName="#channel";activeChannel&&(channelName="#"+activeChannel.id),ws.send(JSON.stringify({msg:message,channel:channelName}))},this.setActiveChannel=function(channel){activeChannel=channel}})}();
!function(){"use strict";angular.module("application").service("fb",function(Facebook,$rootScope){var saveAuthResponse=function(authResponse){localStorage.setItem("access-token",authResponse.accessToken),localStorage.setItem("expiresIn",authResponse.expiresIn),localStorage.setItem("userId",authResponse.userId),localStorage.setItem("signedRequest",authResponse.signedRequest)},removeAuthResponse=function(){localStorage.removeItem("access-token"),localStorage.removeItem("expiresIn"),localStorage.removeItem("userId"),localStorage.removeItem("signedRequest")};$rootScope.$watch(function(){return Facebook.isReady()},function(newVal){this.ready=newVal}),this.checkStatus=function(){return new Promise(function(resolve,reject){Facebook.getLoginStatus(function(response){"connected"===response.status?(saveAuthResponse(response.authResponse),resolve()):(removeAuthResponse(),reject())},!0)})},this.login=function(){return new Promise(function(resolve){Facebook.login(function(response){var authResponse=response.authResponse;saveAuthResponse(authResponse),resolve(authResponse.userId)},{scope:"email,user_groups"})})},this.logout=function(){return new Promise(function(resolve){Facebook.logout(function(){removeAuthResponse(),resolve()})})},this.user=function(){return new Promise(function(resolve){Facebook.api("/me",function(response){resolve(response)},{access_token:localStorage.getItem("access-token")})})},this.groups=function(user){return new Promise(function(resolve){Facebook.api("/"+user.id+"/groups",function(groups){resolve(groups.data)},{access_token:localStorage.getItem("access-token")})})}})}();
!function(){"use strict";angular.module("application").service("token",function(){this.set=function(token,expires){localStorage.setItem("token",token),expires&&localStorage.setItem("expires",expires)},this.isValid=function(){return this.get()&&!this.isExpired()},this.unset=function(){localStorage.removeItem("token"),localStorage.removeItem("expires")},this.get=function(){return localStorage.getItem("token")},this.isExpired=function(){var expires=localStorage.getItem("expires"),now=new Date;return expires?now>new Date(expires):!1}})}();
!function(){"use strict";angular.module("application").controller("ChatCtrl",function($scope,chat){$scope.message="",$scope.messages=chat.messages,$scope.send=function(){chat.sendMessage($scope.message),$scope.message=""}})}();
!function(){"use strict";angular.module("application").controller("HomeCtrl",function($scope,$state,chat,user,token){$scope.teams=user.teams,$scope.logout=function(){token.unset(),$state.go("welcome.index")},$scope.changeTeam=function(team){chat.setActiveChannel(team),$state.go("chat",{channel:team.id})}})}();
!function(){"use strict";angular.module("application").controller("NewTeamCtrl",function($scope,backend){$scope.form={},$scope.create=function(){backend.request("createTeam",$scope.form)}})}();
!function(){"use strict";angular.module("application").controller("SigninCtrl",function($scope,$state,backend,token){$scope.signin=function(){backend.request("login",$scope.form).then(function(data){token.set(data.token),$state.go("chat")})}})}();
!function(){"use strict";angular.module("application").controller("SignupCtrl",function($scope,$state,backend){$scope.form={},$scope.signup=function(){backend.request("signup",$scope.form).then(function(){$state.go("signin")})}})}();
!function(){"use strict";angular.module("application").controller("WelcomeIndexCtrl",function($scope,$rootScope,$state,fb){$scope.fbReady=fb.ready,$scope.login=function(){fb.login().then(function(){$state.go("home")})}})}();
!function(){"use strict";angular.module("application").controller("WelcomeCtrl",function($scope,$rootScope,$state,fb){$scope.fbReady=fb.ready,$scope.login=function(){fb.login().then(function(){$state.go("home")})}})}();